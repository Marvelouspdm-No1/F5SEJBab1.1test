<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <title>F5 SEJ BAB 1.1 Quiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f2f2f2;
            max-width: 800px;
            margin: 0 auto;
        }
        .question {
            background: #fff;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .result {
            background: #e6ffe6;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .history {
            background: #e6f3ff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .hidden {
            display: none;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background: #ddd;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background: #4CAF50;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .correct {
            color: green;
        }
        .incorrect {
            color: red;
        }
        .save-buttons {
            margin-top: 20px;
            text-align: center;
        }
        .save-btn {
            background-color: #2196F3;
            margin: 5px;
        }
        .save-btn:hover {
            background-color: #0b7dda;
        }
        .download-btn {
            background-color: #FF6B35;
            margin: 5px;
        }
        .download-btn:hover {
            background-color: #E55A2B;
        }
        #reportCanvas {
            text-align: center;
        }
        .canvas-container {
            display: inline-block;
            margin: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background: white;
        }
        label {
            display: block;
            margin: 8px 0;
            cursor: pointer;
            padding: 15px 12px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            background-color: #fff;
            transition: all 0.3s ease;
            font-size: 16px;
            line-height: 1.4;
            min-height: 50px;
            display: flex;
            align-items: center;
        }
        label:hover {
            background-color: #f5f5f5;
            border-color: #2196F3;
        }
        label:active {
            background-color: #e3f2fd;
        }
        input[type="radio"] {
            margin-right: 12px;
            width: 20px;
            height: 20px;
            cursor: pointer;
            flex-shrink: 0;
        }
        input[type="radio"]:checked + span {
            font-weight: bold;
            color: #2196F3;
        }
        label.selected {
            background-color: #e3f2fd;
            border-color: #2196F3;
            font-weight: bold;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                font-size: 16px;
            }
            .question {
                padding: 20px 15px;
                margin-bottom: 15px;
            }
            label {
                padding: 18px 15px;
                font-size: 17px;
                min-height: 60px;
            }
            input[type="radio"] {
                width: 22px;
                height: 22px;
                margin-right: 15px;
            }
            button {
                padding: 15px 25px;
                font-size: 17px;
                margin: 8px 5px;
                width: 100%;
                max-width: 300px;
            }
            h2 {
                font-size: 20px;
                line-height: 1.3;
            }
            .info-box {
                padding: 15px 12px;
                font-size: 15px;
            }
            .tab {
                padding: 12px 15px;
                font-size: 16px;
            }
        }
        .info-box {
            background: #e6f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }
    </style>
</head>
<body>

<h2>F5 SEJ BAB 1.1 Quiz - Kedaulatan Negara</h2>
<div class="info-box">
    <p><strong>ğŸ’¡ æ¸©é¦¨æç¤ºï¼š</strong></p>
    <p>â€¢ ğŸ–¼ï¸ <strong>ç”Ÿæˆæˆç»©å•å›¾ç‰‡</strong> - åˆ¶ä½œæ­£å¼çš„æˆç»©å•å›¾ç‰‡ï¼Œå¯ä¿å­˜å’Œåˆ†äº«</p>
    <p>â€¢ ğŸ’¾ <strong>ä¿å­˜è¿›åº¦åŠŸèƒ½</strong> - å¯ä»¥éšæ—¶ä¿å­˜æµ‹éªŒè¿›åº¦ï¼Œç¨åç»§ç»­ä½œç­”</p>
    <p>â€¢ ğŸ“š æœ¬æµ‹éªŒæ¶µç›–Bab 1.1å›½å®¶ä¸»æƒ(Kedaulatan Negara)çš„é‡è¦çŸ¥è¯†ç‚¹</p>
    <p>â€¢ ğŸ“± æ‰‹æœºç«¯å·²ä¼˜åŒ–ï¼Œé€‰é¡¹æŒ‰é’®æ›´å¤§æ›´å®¹æ˜“ç‚¹å‡»</p>
</div>

<div class="tabs">
    <div class="tab active" onclick="showTab('quiz')">åšæµ‹éªŒ</div>
    <div class="tab" onclick="showTab('history')">æŸ¥çœ‹è®°å½•</div>
</div>

<div id="quiz" class="tab-content active">
    <form id="quizForm">
        <label>Name (åå­—):</label><br>
        <input type="text" id="name" required><br><br>

        <label>Form (å¹´çº§):</label><br>
        <select id="form" required>
            <option value="">Select</option>
            <option value="F1">F1</option>
            <option value="F2">F2</option>
            <option value="F3">F3</option>
            <option value="F4">F4</option>
            <option value="F5">F5</option>
        </select><br><br>

        <div id="questions"></div>

        <button type="button" onclick="submitQuiz()">æäº¤ç­”æ¡ˆ</button>
        <button type="button" onclick="saveProgress()">ä¿å­˜è¿›åº¦</button>
        <button type="button" onclick="loadProgress()">åŠ è½½è¿›åº¦</button>
    </form>

    <div id="result" class="result hidden"></div>
</div>

<div id="history" class="tab-content">
    <h3>ä½ çš„æµ‹éªŒè®°å½•</h3>
    <div id="historyList"></div>
</div>

<script>
const questions = [
    {
        q: "Deklarasi Hubungan Persahabatan PBB telah diperkenalkan pada tahun 1970. Apakah kepentingan deklarasi tersebut?",
        options: [
            "Menekankan prinsip persamaan kedaulatan",
            "Mewujudkan pakatan ketenteraan",
            "Menghapuskan amalan kuasa veto",
            "Menamatkan persaingan senjata nuclear"
        ],
        answer: "Menekankan prinsip persamaan kedaulatan",
        explain: "Deklarasi Hubungan Persahabatan PBB 1970 mengesahkan prinsip persamaan kedaulatan dari segi undang-undang antarabangsa, yang penting untuk mengiktiraf kedudukan sama rata semua negara berdaulat.",
        encourage: "å¾ˆå¥½ï¼ä½ æŒæ¡äº†å›½é™…æ³•ä¸­ä¸»æƒå¹³ç­‰åŸåˆ™çš„é‡è¦æ€§ã€‚"
    },
    {
        q: "Maklumat berikut berkaitan dengan peristiwa bersejarah di negara kita: Kemerdekaan Tanah Melayu 31 Ogos 1957 dan Pembentukan Malaysia 16 September 1963. Peristiwa di atas berkaitan dengan:",
        options: ["Perlembagaan", "Pentadbiran", "Kedaulatan", "Demokrasi"],
        answer: "Kedaulatan",
        explain: "Kemerdekaan Tanah Melayu 1957 dan pembentukan Malaysia 1963 mengukuhkan serta memantapkan negara bangsa kita yang bebas dan berdaulat.",
        encourage: "å‡ºè‰²ï¼ä½ ç†è§£äº†è¿™äº›å†å²äº‹ä»¶ä¸å›½å®¶ä¸»æƒçš„å…³ç³»ã€‚"
    },
    {
        q: "Berikut adalah perkataan Bahasa Yunani berkaitan kedaulatan: Supernuus dan Superanus. Perkataan tersebut merujuk negara yang:",
        options: ["Beraja", "Merdeka", "Autokrasi", "Demokrasi"],
        answer: "Merdeka",
        explain: "Dalam Bahasa Yunani, supernuus atau superanus bermaksud agung atau tertinggi, merujuk kepada negara yang bebas dan merdeka.",
        encourage: "æ­£ç¡®ï¼ä½ æŒæ¡äº†ä¸»æƒæ¦‚å¿µçš„è¯æºå­¦çŸ¥è¯†ã€‚"
    },
    {
        q: "Mengapakah rakyat Malaysia perlu menghargai tokoh nasionalis negara?",
        options: [
            "Memupuk semangat patriotisme",
            "Menyusun semula masyarakat",
            "Mendapat pengiktirafan",
            "Memelihara maruah"
        ],
        answer: "Memupuk semangat patriotisme",
        explain: "Menghargai tokoh nasionalis negara dapat memupuk semangat patriotisme dan cinta akan negara dalam kalangan rakyat Malaysia.",
        encourage: "å¤ªæ£’äº†ï¼ä½ æ˜ç™½äº†å°Šé‡æ°‘æ—ä¸»ä¹‰äººç‰©çš„é‡è¦æ„ä¹‰ã€‚"
    },
    {
        q: "Rajah berikut merujuk jenis kedaulatan dalam masyarakat Melayu: Raja mempunyai kuasa tertinggi; Kedudukan raja diperkukuh oleh taat setia rakyat. X ialah kedaulatan:",
        options: ["Moden", "Tradisional", "Antarabangsa", "Undang-undang"],
        answer: "Tradisional",
        explain: "Kedaulatan Tradisional dalam sistem pemerintahan berkuasa mutlak pada kekuasaan dan kewibawaan raja, dengan kedudukan raja diperkukuhkan oleh taat setia rakyat.",
        encourage: "éå¸¸å¥½ï¼ä½ èƒ½åŒºåˆ†ä¼ ç»Ÿä¸»æƒä¸ç°ä»£ä¸»æƒçš„ç‰¹å¾ã€‚"
    },
    {
        q: "Apakah langkah yang dilakukan untuk memelihara dan melaksanakan kedaulatan undang-undang di negara kita?",
        options: [
            "Mewujudkan badan kehakiman",
            "Membuat pindaan perlembagaan",
            "Melaksanakan undang-undang moden",
            "Menubuhkan Suruhanjaya Kehakiman"
        ],
        answer: "Mewujudkan badan kehakiman",
        explain: "Badan kehakiman diwujudkan untuk memelihara dan melaksanakan kedaulatan undang-undang, menjamin keadilan dalam kehidupan bermasyarakat.",
        encourage: "ä¼˜ç§€ï¼ä½ ç†è§£äº†å¸æ³•æœºæ„åœ¨ç»´æŠ¤æ³•å¾‹ä¸»æƒä¸­çš„ä½œç”¨ã€‚"
    },
    {
        q: "Pernyataan yang manakah berkaitan dengan kedaulatan tradisional? I. Diperkukuh kesetiaan rakyat II. Persamaan rumpun bangsa III. Prinsip keadilan ditegakkan IV. Pemerintah berkuasa mutlak",
        options: ["I dan II", "I dan IV", "II dan III", "III dan IV"],
        answer: "I dan IV",
        explain: "Kedaulatan Tradisional dicirikan dengan pemerintah berkuasa mutlak dan kedudukan raja diperkukuhkan oleh taat setia rakyat.",
        encourage: "å¾ˆå¥½ï¼ä½ èƒ½å‡†ç¡®è¯†åˆ«ä¼ ç»Ÿä¸»æƒçš„æ ¸å¿ƒç‰¹å¾ã€‚"
    },
    {
        q: "Penyataan berikut merupakan tafsiran berkaitan kedaulatan: 'Kedaulatan dibina berdasarkan prinsip kebebasan dan keadilan yang sentiasa memperjuangkan kebajikan dan kesejahteraan rakyat.' Siapakah tokoh yang telah membuat tafsiran tersebut?",
        options: [
            "Ibn Khaldun",
            "Tun Dr. Salleh Abas",
            "Dr. Ismail Abdul Rahman",
            "Tunku Abdul Rahman Putra al-Haj"
        ],
        answer: "Tunku Abdul Rahman Putra al-Haj",
        explain: "Tunku Abdul Rahman Putra al-Haj (Perdana Menteri Malaysia Pertama) mentafsirkan kedaulatan berdasarkan prinsip kebebasan, kebajikan dan keadilan.",
        encourage: "å‡ºè‰²ï¼ä½ ç†Ÿæ‚‰é©¬æ¥è¥¿äºšå¼€å›½é¢†è¢–å¯¹ä¸»æƒçš„è¯ é‡Šã€‚"
    },
    {
        q: "Mengapakah kedaulatan penting bagi sesebuah negara?",
        options: [
            "Mewujudkan kesejahteraan rakyat",
            "Menjadi kuasa politik unggul di dunia",
            "Menunjukkan kekuatan angkatan tentera",
            "Membuktikan dasar luar mengikut situasi semasa"
        ],
        answer: "Mewujudkan kesejahteraan rakyat",
        explain: "Kedaulatan penting untuk mewujudkan kesejahteraan rakyat melalui keberkesanan pentadbiran, kemakmuran ekonomi dan kestabilan politik.",
        encourage: "æ­£ç¡®ï¼ä½ ç†è§£äº†ä¸»æƒå¯¹äººæ°‘ç¦ç¥‰çš„é‡è¦æ€§ã€‚"
    },
    {
        q: "Apakah kepentingan konsep Daulat dalam sistem politik Melayu tradisional? I. Memperkukuh kedudukan raja-raja II. Memperluas peranan golongan pembesar III. Menyekat peluasan pengaruh kuasa asing IV. Mengikat kesetiaan rakyat terhadap raja",
        options: ["I dan II", "I dan IV", "II dan III", "III dan IV"],
        answer: "I dan IV",
        explain: "Konsep Daulat dalam sistem politik Melayu tradisional penting untuk memperkukuh kedudukan raja-raja dan mengikat kesetiaan rakyat terhadap raja.",
        encourage: "éå¸¸å¥½ï¼ä½ æŒæ¡äº†é©¬æ¥ä¼ ç»Ÿæ”¿æ²»ä¸­Daulatæ¦‚å¿µçš„æ„ä¹‰ã€‚"
    }
];

function showTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    document.getElementById(tabId).classList.add('active');
    
    event.currentTarget.classList.add('active');
    
    if (tabId === 'history') {
        loadHistory();
    }
}

function submitQuiz() {
    const name = document.getElementById('name').value;
    const form = document.getElementById('form').value;
    
    if (!name || !form) {
        alert("è¯·å¡«å†™å®Œæ•´çš„ä¸ªäººä¿¡æ¯ï¼");
        return;
    }
    
    let score = 0;
    let results = [];
    let unanswered = 0;
    
    questions.forEach((q, index) => {
        const selected = document.querySelector(`input[name="q${index}"]:checked`);
        const isCorrect = selected && selected.value === q.answer;
        
        if (isCorrect) score++;
        if (!selected) unanswered++;
        
        results.push({
            question: q.q,
            selected: selected ? selected.value : "æœªä½œç­”",
            correct: q.answer,
            isCorrect: isCorrect,
            explain: q.explain,
            encourage: q.encourage
        });
    });
    
    saveAttempt(name, form, score, results);
    displayResults(name, form, score, results, unanswered);
}

function displayResults(name, form, score, results, unanswered) {
    let output = `
        <h3>åå­—: ${name}</h3>
        <h3>å¹´çº§: ${form}</h3>
        <h3>å¾—åˆ†: <span class="${score >= 8 ? 'correct' : 'incorrect'}">${score} / 10</span></h3>
        ${unanswered > 0 ? `<p>æ³¨æ„ï¼šä½ æœ‰ ${unanswered} é¢˜æ²¡æœ‰ä½œç­”</p>` : ''}
        <p>${getFeedback(score)}</p>
        <div class="save-buttons">
            <button class="download-btn" onclick="generateReportImage('${name}', '${form}', ${score}, ${unanswered})">ğŸ–¼ï¸ ç”Ÿæˆæˆç»©å•å›¾ç‰‡</button>
        </div>
        <div id="reportCanvas" style="margin-top: 20px;"></div>
        <hr>
    `;
    
    results.forEach((r, index) => {
        output += `
            <div class="question">
                <p><strong>ç¬¬${index + 1}é¢˜ï¼š${r.isCorrect ? 'æ­£ç¡® âœ…' : 'é”™è¯¯ âŒ'}</strong></p>
                <p>é¢˜ç›®: ${r.question}</p>
                ${!r.isCorrect ? `<p>ä½ çš„ç­”æ¡ˆ: <span class="incorrect">${r.selected}</span></p>` : ''}
                <p>æ­£ç¡®ç­”æ¡ˆ: <span class="correct">${r.correct}</span></p>
                <p>è§£é‡Š: ${r.explain}</p>
                <p>é¼“åŠ±: ${r.encourage}</p>
            </div>
        `;
    });
    
    document.getElementById('result').innerHTML = output;
    document.getElementById('result').classList.remove('hidden');
    document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
}

function getFeedback(score) {
    if (score === 10) {
        return "å¤ªå‰å®³å•¦ï¼å…¨å¯¹è€¶ï¼ä½ å¯¹å›½å®¶ä¸»æƒçš„æŒæ¡éå¸¸å®Œç¾ï¼ğŸ‰ å†å²å­¦éœ¸å°±æ˜¯ä½ ï¼";
    } else if (score >= 9) {
        return "æˆç»©ä¼˜å¼‚ï¼ä½ å¯¹å›½å®¶ä¸»æƒçš„ç†è§£å¾ˆæ·±å…¥ï¼Œåªæœ‰å°‘è®¸ç»†èŠ‚éœ€è¦æ³¨æ„ï¼âœ¨ ç»§ç»­ä¿æŒï¼";
    } else if (score >= 7) {
        return "å¾ˆä¸é”™ï¼åŸºæœ¬æ¦‚å¿µéƒ½æŒæ¡äº†ï¼Œå¯¹å†å²å‘å±•è„‰ç»œç†è§£å¾—å¾ˆå¥½ï¼ğŸ˜Š åŠ æ²¹ï¼";
    } else if (score >= 5) {
        return "æœ‰è¿›æ­¥ç©ºé—´ï¼å»ºè®®å¤šå¤ä¹ ä¸»æƒçš„å®šä¹‰ã€ç±»å‹å’Œé‡è¦æ€§ï¼Œä½ ä¼šæ›´æ£’çš„ï¼ğŸ’ª";
    } else if (score >= 3) {
        return "éœ€è¦åŠ å¼ºå¤ä¹ å“¦ï¼é‡ç‚¹å…³æ³¨ä¸»æƒçš„æ¦‚å¿µå’Œé©¬æ¥è¥¿äºšä¸»æƒçš„å‘å±•ï¼ğŸ“š";
    } else {
        return "å»ºè®®é‡æ–°å­¦ä¹ è¿™ä¸ªç« èŠ‚ï¼Œå¤šçœ‹è¯¾æœ¬å’Œç¬”è®°ï¼Œå†å²éœ€è¦æ…¢æ…¢ç§¯ç´¯çš„ï¼ğŸŒ± ä¸è¦æ”¾å¼ƒï¼";
    }
}

function formatDate(date) {
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const year = date.getFullYear();
    return `${day}/${month}/${year}`;
}

function generateReportImage(name, form, score, unanswered) {
    let wrongAnswers = [];
    questions.forEach((q, index) => {
        const selected = document.querySelector(`input[name="q${index}"]:checked`);
        const isCorrect = selected && selected.value === q.answer;
        if (!isCorrect) {
            wrongAnswers.push({
                number: index + 1,
                question: q.q.substring(0, 50) + "...",
                selected: selected ? selected.value : "æœªä½œç­”",
                correct: q.answer
            });
        }
    });

    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    
    const baseHeight = 800;
    const errorHeight = wrongAnswers.length * 30 + 100;
    canvas.width = 800;
    canvas.height = Math.max(baseHeight, baseHeight + errorHeight);
    
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#f8f9fa');
    gradient.addColorStop(1, '#e9ecef');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    ctx.fillStyle = '#2c3e50';
    ctx.fillRect(0, 0, canvas.width, 120);
    
    ctx.fillStyle = 'white';
    ctx.font = 'bold 28px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('F5 SEJ BAB 1.1 Quiz', canvas.width/2, 45);
    ctx.font = 'bold 24px Arial';
    ctx.fillText('Kedaulatan Negara', canvas.width/2, 75);
    ctx.font = '18px Arial';
    ctx.fillText('å›½å®¶ä¸»æƒæµ‹éªŒæˆç»©å•', canvas.width/2, 100);
    
    ctx.fillStyle = '#333';
    ctx.font = 'bold 24px Arial';
    ctx.textAlign = 'left';
    ctx.fillText('å­¦ç”Ÿä¿¡æ¯ Student Information', 50, 170);
    
    ctx.font = '20px Arial';
    ctx.fillText(`å§“å Name: ${name}`, 50, 210);
    ctx.fillText(`å¹´çº§ Form: ${form}`, 50, 240);
    ctx.fillText(`æµ‹éªŒæ—¥æœŸ Date: ${formatDate(new Date())}`, 50, 270);
    
    const percentage = Math.round((score / 10) * 100);
    
    ctx.fillStyle = '#2196F3';
    ctx.font = 'bold 24px Arial';
    ctx.fillText('æµ‹éªŒæˆç»© Test Results', 50, 320);
    
    const centerX = canvas.width - 150;
    const centerY = 370;
    const radius = 80;
    
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
    ctx.fillStyle = score >= 8 ? '#4CAF50' : score >= 5 ? '#FF9800' : '#F44336';
    ctx.fill();
    
    ctx.fillStyle = 'white';
    ctx.font = 'bold 36px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(`${score}/10`, centerX, centerY - 10);
    ctx.font = 'bold 20px Arial';
    ctx.fillText(`${percentage}%`, centerX, centerY + 20);
    
    ctx.fillStyle = '#333';
    ctx.font = '20px Arial';
    ctx.textAlign = 'left';
    ctx.fillText(`æ€»åˆ† Total Score: ${score}/10 (${percentage}%)`, 50, 360);
    
    if (unanswered > 0) {
        ctx.fillStyle = '#F44336';
        ctx.fillText(`æœªä½œç­”é¢˜ç›® Unanswered: ${unanswered} é¢˜`, 50, 390);
    }
    
    ctx.fillStyle = '#333';
    ctx.font = 'bold 24px Arial';
    let currentY = unanswered > 0 ? 450 : 420;
    ctx.fillText('è¡¨ç°åˆ†æ Performance Analysis', 50, currentY);
    
    ctx.font = '18px Arial';
    const feedback = getFeedback(score);
    const words = feedback.split(' ');
    let line = '';
    currentY += 30;
    
    for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + ' ';
        const metrics = ctx.measureText(testLine);
        const testWidth = metrics.width;
        if (testWidth > 700 && n > 0) {
            ctx.fillText(line, 50, currentY);
            line = words[n] + ' ';
            currentY += 25;
        } else {
            line = testLine;
        }
    }
    ctx.fillText(line, 50, currentY);
    
    if (wrongAnswers.length > 0) {
        currentY += 50;
        ctx.fillStyle = '#F44336';
        ctx.font = 'bold 20px Arial';
        ctx.fillText(`é”™é¢˜åˆ†æ Wrong Answers (${wrongAnswers.length} é¢˜)`, 50, currentY);
        
        ctx.fillStyle = '#333';
        ctx.font = '16px Arial';
        
        wrongAnswers.forEach((error, index) => {
            currentY += 30;
            ctx.fillText(`${index + 1}. ç¬¬${error.number}é¢˜: ${error.selected} â†’ ${error.correct}`, 50, currentY);
        });
    }
    
    ctx.fillStyle = '#666';
    ctx.font = '14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('ç»§ç»­åŠ æ²¹ï¼Œå­¦å¥½é©¬æ¥è¥¿äºšå†å²ï¼Keep studying Malaysian History!', canvas.width/2, canvas.height - 30);
    
    const reportDiv = document.getElementById('reportCanvas');
    reportDiv.innerHTML = `
        <div class="canvas-container">
            <h3>ğŸ“‹ æˆç»©å•å·²ç”Ÿæˆ</h3>
            <canvas id="generatedCanvas" width="800" height="${canvas.height}" style="max-width: 100%; height: auto; border: 1px solid #ddd;"></canvas>
            <div style="margin-top: 15px;">
                <button class="download-btn" onclick="downloadReportImage()">ğŸ’¾ ä¸‹è½½å›¾ç‰‡</button>
                <button class="save-btn" onclick="shareReportImage()">ğŸ“¤ åˆ†äº«å›¾ç‰‡</button>
            </div>
            <p style="color: #666; font-size: 14px; margin-top: 10px;">
                ğŸ’¡ æç¤ºï¼šç‚¹å‡»"ä¸‹è½½å›¾ç‰‡"ä¿å­˜åˆ°è®¾å¤‡ï¼Œæˆ–ç‚¹å‡»"åˆ†äº«å›¾ç‰‡"é€šè¿‡å…¶ä»–åº”ç”¨åˆ†äº«
            </p>
        </div>
    `;
    
    const displayCanvas = document.getElementById('generatedCanvas');
    displayCanvas.height = canvas.height;
    const displayCtx = displayCanvas.getContext('2d');
    displayCtx.drawImage(canvas, 0, 0);
    
    window.reportCanvas = canvas;
    reportDiv.scrollIntoView({ behavior: 'smooth' });
}

function downloadReportImage() {
    if (window.reportCanvas) {
        const today = new Date();
        const dateStr = formatDate(today).replace(/\//g, '-');
        const link = document.createElement('a');
        link.download = `F5_SEJ_BAB1.1_æˆç»©å•_${dateStr}.png`;
        link.href = window.reportCanvas.toDataURL();
        link.click();
    }
}

function shareReportImage() {
    if (navigator.share && window.reportCanvas) {
        window.reportCanvas.toBlob(function(blob) {
            const file = new File([blob], 'F5_SEJ_BAB1.1_æˆç»©å•.png', { type: 'image/png' });
            navigator.share({
                title: 'F5 SEJ BAB 1.1 Quiz æˆç»©å•',
                text: 'æˆ‘çš„F5å†å²Bab 1.1å›½å®¶ä¸»æƒæµ‹éªŒæˆç»©å•',
                files: [file]
            }).catch(err => {
                console.log('åˆ†äº«å¤±è´¥:', err);
                downloadReportImage();
            });
        });
    } else {
        downloadReportImage();
        alert('æˆç»©å•å›¾ç‰‡å·²ä¸‹è½½åˆ°æ‚¨çš„è®¾å¤‡ ğŸ“±');
    }
}

function saveAttempt(name, form, score, results) {
    const attempts = JSON.parse(localStorage.getItem('f5sej11QuizAttempts') || '[]');
    const attempt = {
        date: new Date().toLocaleString(),
        name,
        form,
        score,
        results
    };
    
    attempts.unshift(attempt);
    localStorage.setItem('f5sej11QuizAttempts', JSON.stringify(attempts));
}

function loadHistory() {
    const attempts = JSON.parse(localStorage.getItem('f5sej11QuizAttempts') || '[]');
    const historyList = document.getElementById('historyList');
    
    if (attempts.length === 0) {
        historyList.innerHTML = "<p>ä½ è¿˜æ²¡æœ‰ä»»ä½•æµ‹éªŒè®°å½•ï¼Œå¿«å»åšæµ‹éªŒå§ï¼</p>";
        return;
    }
    
    let html = "";
    attempts.forEach((attempt, index) => {
        html += `
            <div class="question" style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px;">
                <h3>æµ‹éªŒ #${index + 1} - ${attempt.date}</h3>
                <p>å§“å: ${attempt.name} | å¹´çº§: ${attempt.form}</p>
                <p>å¾—åˆ†: <strong>${attempt.score} / 10</strong></p>
                <button onclick="viewAttemptDetails(${index})">æŸ¥çœ‹è¯¦æƒ…</button>
                <div style="margin-top: 10px;">
                    <button class="download-btn" onclick="generateHistoryReportImage(${index})" style="font-size: 12px; padding: 8px 12px;">ğŸ–¼ï¸ ç”Ÿæˆæˆç»©å•å›¾ç‰‡</button>
                </div>
                <div id="attemptDetails${index}" style="display: none; margin-top: 10px;">
                    ${attempt.results.map((r, qIndex) => `
                        <div style="margin-bottom: 15px; padding: 10px; background: ${r.isCorrect ? '#e6ffe6' : '#ffe6e6'}; border-radius: 5px;">
                            <p><strong>ç¬¬${qIndex + 1}é¢˜ï¼š${r.isCorrect ? 'æ­£ç¡® âœ…' : 'é”™è¯¯ âŒ'}</strong></p>
                            <p>é¢˜ç›®: ${r.question}</p>
                            ${!r.isCorrect ? `<p>ä½ çš„ç­”æ¡ˆ: ${r.selected}</p>` : ''}
                            <p>æ­£ç¡®ç­”æ¡ˆ: ${r.correct}</p>
                            <p>è§£é‡Š: ${r.explain}</p>
                            <p>é¼“åŠ±: ${r.encourage}</p>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    });
    
    historyList.innerHTML = html;
}

function generateHistoryReportImage(attemptIndex) {
    const attempts = JSON.parse(localStorage.getItem('f5sej11QuizAttempts') || '[]');
    const attempt = attempts[attemptIndex];
    
    if (!attempt) {
        alert("æ‰¾ä¸åˆ°è¯¥æµ‹éªŒè®°å½•ï¼");
        return;
    }
    
    const unanswered = attempt.results.filter(r => r.selected === "æœªä½œç­”").length;
    const wrongAnswers = attempt.results.filter(r => !r.isCorrect).map((r, index) => ({
        number: attempt.results.indexOf(r) + 1,
        question: r.question.substring(0, 50) + "...",
        selected: r.selected,
        correct: r.correct
    }));

    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    
    const baseHeight = 800;
    const errorHeight = wrongAnswers.length * 30 + 100;
    canvas.width = 800;
    canvas.height = Math.max(baseHeight, baseHeight + errorHeight);
    
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#f8f9fa');
    gradient.addColorStop(1, '#e9ecef');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    ctx.fillStyle = '#2c3e50';
    ctx.fillRect(0, 0, canvas.width, 120);
    
    ctx.fillStyle = 'white';
    ctx.font = 'bold 28px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('F5 SEJ BAB 1.1 Quiz', canvas.width/2, 45);
    ctx.font = 'bold 24px Arial';
    ctx.fillText('Kedaulatan Negara', canvas.width/2, 75);
    ctx.font = '18px Arial';
    ctx.fillText('å›½å®¶ä¸»æƒæµ‹éªŒæˆç»©å•', canvas.width/2, 100);
    
    ctx.fillStyle = '#333';
    ctx.font = 'bold 24px Arial';
    ctx.textAlign = 'left';
    ctx.fillText('å­¦ç”Ÿä¿¡æ¯ Student Information', 50, 170);
    
    let formattedDate;
    try {
        const attemptDate = new Date(attempt.date);
        formattedDate = formatDate(attemptDate);
    } catch (error) {
        formattedDate = attempt.date;
    }
    
    ctx.font = '20px Arial';
    ctx.fillText(`å§“å Name: ${attempt.name}`, 50, 210);
    ctx.fillText(`å¹´çº§ Form: ${attempt.form}`, 50, 240);
    ctx.fillText(`æµ‹éªŒæ—¥æœŸ Date: ${formattedDate}`, 50, 270);
    
    const percentage = Math.round((attempt.score / 10) * 100);
    
    ctx.fillStyle = '#2196F3';
    ctx.font = 'bold 24px Arial';
    ctx.fillText('æµ‹éªŒæˆç»© Test Results', 50, 320);
    
    const centerX = canvas.width - 150;
    const centerY = 370;
    const radius = 80;
    
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
    ctx.fillStyle = attempt.score >= 8 ? '#4CAF50' : attempt.score >= 5 ? '#FF9800' : '#F44336';
    ctx.fill();
    
    ctx.fillStyle = 'white';
    ctx.font = 'bold 36px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(`${attempt.score}/10`, centerX, centerY - 10);
    ctx.font = 'bold 20px Arial';
    ctx.fillText(`${percentage}%`, centerX, centerY + 20);
    
    ctx.fillStyle = '#333';
    ctx.font = '20px Arial';
    ctx.textAlign = 'left';
    ctx.fillText(`æ€»åˆ† Total Score: ${attempt.score}/10 (${percentage}%)`, 50, 360);
    
    if (unanswered > 0) {
        ctx.fillStyle = '#F44336';
        ctx.fillText(`æœªä½œç­”é¢˜ç›® Unanswered: ${unanswered} é¢˜`, 50, 390);
    }
    
    ctx.fillStyle = '#333';
    ctx.font = 'bold 24px Arial';
    let currentY = unanswered > 0 ? 450 : 420;
    ctx.fillText('è¡¨ç°åˆ†æ Performance Analysis', 50, currentY);
    
    ctx.font = '18px Arial';
    const feedback = getFeedback(attempt.score);
    const words = feedback.split(' ');
    let line = '';
    currentY += 30;
    
    for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + ' ';
        const metrics = ctx.measureText(testLine);
        const testWidth = metrics.width;
        if (testWidth > 700 && n > 0) {
            ctx.fillText(line, 50, currentY);
            line = words[n] + ' ';
            currentY += 25;
        } else {
            line = testLine;
        }
    }
    ctx.fillText(line, 50, currentY);
    
    if (wrongAnswers.length > 0) {
        currentY += 50;
        ctx.fillStyle = '#F44336';
        ctx.font = 'bold 20px Arial';
        ctx.fillText(`é”™é¢˜åˆ†æ Wrong Answers (${wrongAnswers.length} é¢˜)`, 50, currentY);
        
        ctx.fillStyle = '#333';
        ctx.font = '16px Arial';
        
        wrongAnswers.forEach((error, index) => {
            currentY += 30;
            ctx.fillText(`${index + 1}. ç¬¬${error.number}é¢˜: ${error.selected} â†’ ${error.correct}`, 50, currentY);
        });
    }
    
    ctx.fillStyle = '#666';
    ctx.font = '14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('ç»§ç»­åŠ æ²¹ï¼Œå­¦å¥½é©¬æ¥è¥¿äºšå†å²ï¼Keep studying Malaysian History!', canvas.width/2, canvas.height - 30);
    
    let downloadDateStr;
    try {
        const attemptDate = new Date(attempt.date);
        downloadDateStr = formatDate(attemptDate).replace(/\//g, '-');
    } catch (error) {
        downloadDateStr = attempt.date.replace(/[/:]/g, '-');
    }
    
    const link = document.createElement('a');
    link.download = `F5_SEJ_BAB1.1_æˆç»©å•_${attempt.name}_${downloadDateStr}.png`;
    link.href = canvas.toDataURL();
    link.click();
    
    alert('æˆç»©å•å›¾ç‰‡å·²ä¸‹è½½ï¼æ‚¨å¯ä»¥ä¿å­˜æˆ–é€šè¿‡å…¶ä»–æ–¹å¼åˆ†äº« ğŸ“±');
}

function viewAttemptDetails(index) {
    const detailsDiv = document.getElementById(`attemptDetails${index}`);
    if (detailsDiv.style.display === 'none') {
        detailsDiv.style.display = 'block';
    } else {
        detailsDiv.style.display = 'none';
    }
}

function saveProgress() {
    const name = document.getElementById('name').value;
    const form = document.getElementById('form').value;
    
    if (!name || !form) {
        alert("è¯·å…ˆå¡«å†™ä¸ªäººä¿¡æ¯ï¼");
        return;
    }
    
    const progress = {
        name,
        form,
        answers: []
    };
    
    questions.forEach((q, index) => {
        const selected = document.querySelector(`input[name="q${index}"]:checked`);
        progress.answers.push(selected ? selected.value : null);
    });
    
    localStorage.setItem('f5sej11QuizProgress', JSON.stringify(progress));
    alert("è¿›åº¦å·²ä¿å­˜ï¼ä½ å¯ä»¥ç¨åå›æ¥ç»§ç»­å®Œæˆæµ‹éªŒã€‚");
}

function loadProgress() {
    const progress = JSON.parse(localStorage.getItem('f5sej11QuizProgress'));
    
    if (!progress) {
        alert("æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„è¿›åº¦ï¼");
        return;
    }
    
    document.getElementById('name').value = progress.name;
    document.getElementById('form').value = progress.form;
    
    progress.answers.forEach((answer, index) => {
        if (answer) {
            const radio = document.querySelector(`input[name="q${index}"][value="${answer}"]`);
            if (radio) {
                radio.checked = true;
                const label = radio.closest('label');
                if (label) {
                    label.classList.add('selected');
                }
            }
        }
    });
    
    alert("è¿›åº¦å·²åŠ è½½ï¼ä½ å¯ä»¥ç»§ç»­å®Œæˆæµ‹éªŒã€‚");
}

window.onload = function() {
    const qDiv = document.getElementById('questions');
    questions.forEach((q, index) => {
        const div = document.createElement('div');
        div.className = "question";
        div.innerHTML = `<p><strong>ç¬¬${index + 1}é¢˜.</strong> ${q.q}</p>` +
                        q.options.map((opt, optIndex) => `
                            <label onclick="selectOption(this, ${index}, ${optIndex})">
                                <input type="radio" name="q${index}" value="${opt}">
                                <span>${opt}</span>
                            </label>
                        `).join('');
        qDiv.appendChild(div);
        
        div.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.checked) {
                    const questionDiv = this.closest('.question');
                    const allLabels = questionDiv.querySelectorAll('label');
                    allLabels.forEach(label => label.classList.remove('selected'));
                    
                    const currentLabel = this.closest('label');
                    if (currentLabel) {
                        currentLabel.classList.add('selected');
                    }
                }
            });
        });
    });
    
    if (localStorage.getItem('f5sej11QuizProgress')) {
        if (confirm("æ£€æµ‹åˆ°æœ‰ä¿å­˜çš„è¿›åº¦ï¼Œæ˜¯å¦åŠ è½½ï¼Ÿ")) {
            loadProgress();
        }
    }
}

function selectOption(labelElement, questionIndex, optionIndex) {
    const questionDiv = labelElement.closest('.question');
    const allLabels = questionDiv.querySelectorAll('label');
    allLabels.forEach(label => label.classList.remove('selected'));
    
    labelElement.classList.add('selected');
    
    const radioButton = labelElement.querySelector('input[type="radio"]');
    radioButton.checked = true;
    
    radioButton.value = questions[questionIndex].options[optionIndex];
}
</script>

</body>
</html>